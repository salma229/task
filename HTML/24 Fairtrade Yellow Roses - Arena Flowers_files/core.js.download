"use strict";/* eslint-disable max-classes-per-file */ /* Global Helpers */ /**
 * POQ integration
 * @type {{init(): void, hideHeaderAndFooter(): void, removeAppsFlyer(): void}}
 */const POQ={hideHeaderAndFooter(){[".header","header",".upper-nav","footer"].forEach(a=>{const b=document.querySelectorAll(a);0<b.length&&b.forEach(a=>{a.style.display="none"})});const a=document.querySelector("main.account")||document.querySelector("body > main");a&&(a.style.paddingTop="0",a.style.paddingBottom="6rem");// Show back the 'Add Address'
const b=document.querySelector("#addAddress");if(b&&a){const c=document.createElement("header");c.style.marginTop="1rem";const d=a.querySelector("h1");d&&c.appendChild(d),c.appendChild(b),a.prepend(c)}},removeAppsFlyer(){/*
    * The banner is added to the DOM with a delay,
    * so to remove it, we need to watch when it is added.
    * AF('banners', 'hideBanner') function to hide banner provided by Appsflyer API
    */const a=document.body,b=new MutationObserver(a=>{Array.from(a).forEach(a=>{let{addedNodes:c}=a;0<c.length&&c.forEach(a=>{"responsive-wrapper"===a.className&&("function"==typeof AF&&AF("banners","hideBanner"),b.disconnect())})})});b.observe(a,{attributes:!1,childList:!0,subtree:!1})},init(){const a=navigator.userAgent||Request.UserAgent;a&&a.match(/Arena|Poq/i)&&(console.warn("POQ mode."),window.isPoqMode=!0,this.hideHeaderAndFooter(),this.removeAppsFlyer())}};POQ.init();/**
 * Creates a modal window.
 */class ArenaModal{/**
   * Constructor
   * @param txtHeader header
   * @param txtBody body
   * @param txtClose close btn text
   * @param funcClose function to invoke when Close button is clicked
   * @param isError if true, header is red.
   */constructor(a,b,c,d){let e=!!(4<arguments.length&&arguments[4]!==void 0)&&arguments[4];this.div=document.createElement("div"),this.funcClose=d,this._init(a,b,c,d,e)}/**
   * Initializes this component.
   * @private
   */_init(a,b,c,d,e){const f=e?" class='error'":"";this.div.classList.add("arena-modal"),this.div.innerHTML="\n      <div class=\"arena-modal_content\">\n        <h2".concat(f,">").concat(a||"","</h2>\n        <div class=\"arena-modal_body\">").concat(b,"</div>\n        <button class=\"btn arena-modal_btn\">").concat(c,"</button>\n      </div>\n    "),this.funcClose&&this.div.querySelector("button.arena-modal_btn").addEventListener("click",d),document.body.appendChild(this.div)}/**
   * Shows modal window
   */show(){this.div.classList.remove("hide")}/**
   * Hides modal window
   */hide(){this.div.classList.add("hide")}/**
   * Removes this component and listeners.
   */remove(){this.funcClose&&this.div.querySelector("button.arena-modal_btn").removeEventListener("click",this.funcClose),document.body.removeChild(this.div)}}// eslint-disable-next-line no-unused-vars
class ArenaException extends Error{constructor(a,b,c){super(a),this.name="ArenaException";this.level=["debug","info","warning","error","critical"].includes(c)?c:"debug",this.data=b,Error.captureStackTrace&&Error.captureStackTrace(this,ArenaException),"object"==typeof Rollbar&&Rollbar.captureEvent({message:a,data:this.data},this.level)}}/**
 * XMLHttpRequest with calback
 *
 * @param {Object} request
 * @param {string} request.url
 * @param {string} [request.method = 'GET']
 * @param {Object} [request.headers = {}]
 * @param {string} request.headers[].key
 * @param {string} request.headers[].value
 * @param {string} [request.data = null]
 *
 * @returns {Promise}
 */const callAPI=a=>{let{url:b,method:c="GET",headers:d={},data:e=null}=a;return new Promise((a,f)=>{const g=new XMLHttpRequest;g.open(c,b),Object.entries(d).forEach(a=>{let[b,c]=a;b&&c&&g.setRequestHeader(b,c)}),g.send(e),g.onload=()=>{200<=g.status&&300>g.status?a(g.response):f(new Error(JSON.stringify({status:g.status,response:g.responseText})))},g.onerror=()=>{f(new Error(JSON.stringify({status:g.status,response:g.responseText})))}})};// Function to make IE9+ support forEach:
window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function setCookie(a,b,c){const e=new Date;e.setTime(e.getTime()+1e3*(60*(60*(24*c))));const d="expires=".concat(e.toUTCString());document.cookie="".concat(a,"=").concat(b,";").concat(d,";path=/")}function getCookie(a){const b="".concat(a,"="),c=decodeURIComponent(document.cookie),d=c.split(";");for(let e,c=0;c<d.length;c+=1){for(e=d[c];" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}function removeSelected(a){a.forEach(a=>{a.classList.remove("selected")})}const currencyFormat=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}),dateFormat=new Intl.DateTimeFormat("en-GB");// Add together all quantity fields
// Must be an edge node type
function sumQuantity(a){return a.reduce((c,a)=>c+(a.node.quantity||0),0)}/* check the cart is deliverable */function countLetterbox(a){const b=a.filter(a=>-1<a.node.variant.product.tags.indexOf("Letterbox"));return sumQuantity(b)}function countBouquets(a){const b=a.filter(a=>"Bouquet"===a.node.variant.product.productType);return sumQuantity(b)}function countDigitalGiftCards(a){const b=a.filter(a=>"Digital Gift Card"===a.node.variant.product.productType);return sumQuantity(b)}function countGreetingCards(a){const b=a.filter(a=>{let{node:b}=a;const{variant:{product:{productType:c}={}}={}}=b;return"Greeting Card"===c||"Card"===c});return sumQuantity(b)}function checkCartValid(a){// Cart's not empty?
const b=sumQuantity(a,"quantity");if(1>b)return"EMPTY";// Letterbox with more than a card?
const c=countGreetingCards(a),d=countLetterbox(a);if(1<d)return"LBX_MULTI";if(0<d&&2===b&&1>c)return"LBX";if(0<d&&2<b)return"LBX";// More than 1 bouquet?
const e=countBouquets(a);if(1<e)return"BOUQUETS";// More than 1 card
if(1<c)return"CARDS";// Only a card without product
if(1>=b&&1<=c)return"ONLY_CARD";// Digital gift cards
const f=countDigitalGiftCards(a);return!(0<f&&f<b)||"DIGITAL_ONLY"}/* Cart */ // Update cart badge
function updateCartBadge(a){const b=parseInt(a,10)||0,c=document.getElementById("headerCartLink"),d=c.querySelector(".badge");d.innerText=b}const cleanCheckoutCookies=()=>{setCookie("cartCount",0,-1),setCookie("checkoutId",0,-1),setCookie("checkoutUrl",0,-1),localStorage.removeItem("checkoutObj"),updateCartBadge(0)},cleanAccountCookies=()=>{setCookie("accessToken",0,-1),setCookie("accessTokenExpiry",0,-1),setCookie("smileCustId",0,-1),setCookie("smileDigest",0,-1)};// Main check for checkout Id and get cart size
function checkForCheckout(){const a=getCookie("checkoutId");if(updateCartBadge(getCookie("cartCount")||0),!a||""===a.trim())return void cleanCheckoutCookies();const b="".concat(apiUrlBase,"/cart/?checkoutId=").concat(a,"&v=").concat(new Date().getTime());callAPI({url:b}).then(a=>{const{data:{node:b}={}}=JSON.parse(a);if(!b||null!==b.completedAt)return void cleanCheckoutCookies();const{lineItems:{edges:c}={}}=b;if(!c||0>=c.length)return void cleanCheckoutCookies();const d=c.reduce((c,a)=>c+(a.node.quantity||0),0);setCookie("cartCount",d,1),updateCartBadge(d),localStorage.setItem("checkoutObj",JSON.stringify(b))}).catch(c=>{throw cleanCheckoutCookies(),new ArenaException("Error fetching checkout=> API Lambda(/cart)",{error:c,params:{checkoutId:a},url:b},"debug")})}checkForCheckout();/* update login link returnUrls */function updateLoginLinkReturnUrls(a){const b=document.querySelectorAll("a.login");b.forEach(b=>{const c=b.getAttribute("href");0>c.indexOf("returnUrl")&&b.setAttribute("href","".concat(c,"?returnUrl=").concat(encodeURI(a)))})}/* Login check */const accessToken=getCookie("accessToken"),loginLinks=document.getElementById("loginLinks"),loginLinksTop=document.getElementById("loginLinksTop");if(accessToken){// Swap the mobile menu login and logout links around
const a=loginLinks.querySelectorAll("li");a[0].classList.add("hide"),a[1].classList.add("hide"),a[2].classList.remove("hide"),a[3].classList.remove("hide");// Swap the header login and logout links around
const b=loginLinksTop.querySelectorAll("li");b[1].classList.add("hide"),b[2].classList.remove("hide")}else cleanAccountCookies();/* HTML include requestor */function fetchHtmlInclude(a,b){const c=new XMLHttpRequest;c.open("GET",a),c.send(),c.addEventListener("loadend",()=>{200===c.status&&(""===c.responseText.trim()?b(!1):b(c.responseText))})}/* Grab latest USP callouts */fetchHtmlInclude("/contentful/usp-include.html",a=>{if(!1!==a){const b=document.querySelector("header .upper-nav .static").cloneNode(!0),c=document.querySelector("header .upper-nav");c.innerHTML=a,c.appendChild(b)}});/* Grab latest announcement bar */const announcementBar=document.getElementById("announcementBar");announcementBar&&fetchHtmlInclude("/contentful/announcement.html",a=>{!1!==a&&(announcementBar.innerHTML=a,announcementBar.classList.remove("hide"))});function showToast(a){let{title:b,message:c,type:d,time:e=3}=a;if(b){const a=document.getElementsByTagName("body")[0],f=document.createElement("div");f.setAttribute("id","toast");const g=document.createElement("div"),h=document.createElement("h3");if(h.innerText=b,g.appendChild(h),c){const a=new DOMParser,b=document.createElement("div"),d=["BR","B","#text","CENTER","STRONG","P"],e=[...a.parseFromString(c,"text/html").body.childNodes];e.forEach(a=>{d.includes(a.nodeName)?b.append(a):b.append(a.textContent)}),g.appendChild(b)}const i=["success","alert","error"].includes(d)?d:"info";f.classList.add(i);const j=document.createElement("button");j.textContent="x",j.addEventListener("click",()=>{f.classList.remove("show")}),f.appendChild(g),f.appendChild(j),a.prepend(f),setTimeout(()=>{f.classList.add("show"),setTimeout(()=>{f.classList.remove("show"),setTimeout(()=>{a.removeChild(f)},300)},1e3*e)},300)}}/* Checks if there is a parameter in the url by name, returns the value if found or null */const getUrlParam=a=>{const b=window.location.href,c=new RegExp("[?&]".concat(a,"=([^&#]*)")).exec(b);return Array.isArray(c)?decodeURI(c[1]):null},removeUrlParam=a=>{try{const b=new URL(window.location);return b.searchParams.delete(a),b}catch(a){return null}},checkForDiscountCoupon=()=>{const a=getUrlParam("discount"),b=getCookie("Arena:CouponDiscount"),c=getCookie("checkoutId");let d=!1;if(!b)a&&(// save for the first time, to apply after when we have checkoutId
d={code:a,applied:!1},setCookie("Arena:CouponDiscount",JSON.stringify(d),1),showToast({title:"Coupon Saved",message:"Your discount code has been saved and, if applicable to your order, will be added at checkout",type:"success",time:15}));else if(d=JSON.parse(b),a&&a!==d.code){// Update or set cookie if enter another code in params
const b={code:a,applied:!1};setCookie("Arena:CouponDiscount",JSON.stringify(b),1),Object.assign(d,b),showToast({title:"Coupon Saved",message:"Your discount code has been saved and, if applicable to your order, will be added at checkout",type:"success",time:15})}if(c&&d&&!d.applied){// submit cupom
const a="".concat(apiUrlBase,"/cart/apply-discount/"),b=new XMLHttpRequest;b.open("POST",a),b.setRequestHeader("Content-Type","application/json;charset=UTF-8"),b.send(JSON.stringify({checkoutId:c,discountCode:d.code})),b.addEventListener("loadend",()=>{200===b.status?(Object.assign(d,{applied:!0}),setCookie("Arena:CouponDiscount",JSON.stringify(d),1)):showToast({title:"Error applying coupon",message:"There was an error trying to apply your discount coupon.",type:"error",time:10})})}// remove discount code from url params
if(a){const a=removeUrlParam("discount");a&&window.history.replaceState("","",a)}};/* Remove param from url and return new url */checkForDiscountCoupon();/**
 * MEGA MENU
*/const menu=document.querySelector(".menu"),menuSection=document.querySelector(".menu-section"),menuArrow=document.querySelector(".menu-mobile-arrow"),menuClosed=document.querySelector(".menu-mobile-close"),menuTrigger=document.querySelector(".menu-mobile-trigger"),menuOverlay=document.querySelector(".overlay");let subMenu;// Show & Hide Toggle Menu Function
function toggleMenu(){menu.classList.toggle("active"),menuOverlay.classList.toggle("active")}// Show the Mobile Side Menu Function
function showSubMenu(a){subMenu=a.querySelector(".menu-subs"),subMenu.classList.add("active"),subMenu.style.animation="slideLeft 0.5s ease forwards";const b=a.querySelector("span").parentNode.childNodes[0].textContent;menu.querySelector(".menu-mobile-title").innerHTML=b,menu.querySelector(".menu-mobile-header").classList.add("active")}// Hide the Mobile Side Menu Function
function hideSubMenu(){subMenu.style.animation="slideRight 0.5s ease forwards",setTimeout(()=>{subMenu.classList.remove("active")},300),menu.querySelector(".menu-mobile-title").innerHTML="",menu.querySelector(".menu-mobile-header").classList.remove("active")}menuSection.addEventListener("click",a=>{if(menu.classList.contains("active")&&(0<=a.target.parentNode.className.split(" ").indexOf("menu-item-has-children")&&a.preventDefault(),a.target.closest(".menu-item-has-children"))){const b=a.target.closest(".menu-item-has-children");showSubMenu(b)}}),menuArrow.addEventListener("click",()=>{hideSubMenu()}),menuTrigger.addEventListener("click",()=>{toggleMenu()}),menuClosed.addEventListener("click",()=>{toggleMenu()}),menuOverlay.addEventListener("click",()=>{toggleMenu()}),window.onresize=()=>{991<window.innerWidth&&menu.classList.contains("active")&&toggleMenu()};/**
 * Truncate text by words
 */function truncateByWords(a,b){let c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"...";const d=a.trim().split(" "),e=d.slice(0,b),f=e.length<d.length?c:"",g=e.join(" ");return g+f}/**
 * Check for existence and start dynamic rondels
 */function resizeRoundelFont(){const a=document.querySelectorAll(".roundel-text p");0<a.length&&(a.forEach(a=>{const b=a.textContent,c=a.parentNode,d=c.offsetWidth,e=6+5/29*(b.length-3);a.style.fontSize="".concat(d/e,"px")}),window.addEventListener("resize",resizeRoundelFont))}window.addEventListener("DOMContentLoaded",resizeRoundelFont);/**
 * initialize tooltips
 */const tooltips=document.querySelectorAll("[data-tip]");tooltips&&Array.from(tooltips).forEach(a=>{a.addEventListener("click",a=>{let{target:b}=a;"I"===b.nodeName?b.parentNode.classList.toggle("open"):b.classList.toggle("open")})});/**
 * Enable mouse drag and scroll X
 */function mouseScrollX(a){const b=document.querySelector(a);if(!b)return;let c,d,f=!1;b.addEventListener("mousedown",a=>{f=!0,c=a.pageX-b.offsetLeft,d=b.scrollLeft,b.style.cursor="grabbing",b.classList.add("scrolling")}),b.addEventListener("mouseleave",()=>{f=!1,b.style.cursor="default",b.classList.remove("scrolling")}),b.addEventListener("mouseup",()=>{f=!1,b.style.cursor="default",b.classList.remove("scrolling")}),b.addEventListener("mousemove",a=>{if(!f)return;a.preventDefault();const e=a.pageX-b.offsetLeft,g=3*(e-c);// scroll-fast
b.scrollLeft=d-g})}