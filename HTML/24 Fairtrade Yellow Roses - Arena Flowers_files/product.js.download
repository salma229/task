"use strict";/* Options functionality */const productVariant=document.getElementById("productVariant"),optionGroups=document.querySelectorAll(".options ul"),thePrice=document.getElementById("thePrice"),productVariantSku=document.getElementById("productVariantSku"),productForm=document.getElementById("productForm"),submitButton=document.getElementById("form-submit"),showCardEditor=!!productForm.getAttribute("data-show-cards"),urlParams=new URLSearchParams(window.location.search),isPetFriendly=urlParams.get("variant"),isGift=urlParams.get("gift");isGift&&(document.querySelector("form .options").style.display="none");const calcDiffPrices=a=>{try{if(productVariant&&productVariant.options&&0<productVariant.options.length){const b=[];Array.from(optionGroups).forEach(a=>{const c=a.querySelector("li.selected");b.push(c.getAttribute("data-value").replace(/\s+/g,"").toLowerCase()),c.querySelector("span").innerText=""}),Array.from(productVariant).forEach(c=>{// Select options <select>
const d=c.innerText.split("/").map(a=>a.replace(/\s+/g,"").toLowerCase());if(Array.from(d).some(a=>b.includes(a))&&!c.selected){const b=document.querySelectorAll(".options ul li:not(.selected)");b.forEach(b=>{const e=b.getAttribute("data-value").replace(/\s+/g,"").toLowerCase();if(d.includes(e)){const d=b.querySelector("span"),e=parseFloat(c.getAttribute("data-price")),f=parseFloat(e-a),g=0<=f?"+":"-";d.innerText="".concat(g," \xA3 ").concat(Math.abs(f).toFixed(2))}})}})}}catch(a){console.log("Unable to show prices diff",a)}},getSelectedOptions=()=>{// Build variant name from options selected
const a=Array.from(document.querySelectorAll(".options li.selected")),b=a.map(a=>a.getAttribute("data-value")).join(" / "),c=thePrice.querySelector(".price"),d=thePrice.querySelector(".reduced");if(productVariant&&productVariant.options&&0<productVariant.options.length)// Cycle through variants and select matching one
for(let a=0;a<productVariant.options.length;a+=1)if(productVariant.options[a].innerText.replace(/\s+/g,"")===b.replace(/\s+/g,"")){const b=productVariant.options[a].getAttribute("data-price"),e=productVariant.options[a].getAttribute("data-compare-price")||!1;productVariant.options[a].selected=!0,c.innerHTML="&pound;".concat(b),calcDiffPrices(parseFloat(b)),e&&parseFloat(b)<parseFloat(e)?(d.classList.remove("hide"),d.innerHTML="&pound;".concat(e)):d.classList.add("hide"),productVariantSku.value=productVariant.options[a].getAttribute("data-sku")}};optionGroups.forEach(a=>{const b=a.querySelectorAll("li");// Select Default option
// Add on click handler
isGift&&"1"===isPetFriendly&&b[1]&&b[1].textContent.match(/pet|friendly/i)?b[1].classList.add("selected"):b[0].classList.add("selected"),b.forEach(a=>{a.addEventListener("click",a=>{// Toggle the selected class
// Change the variant select
a.preventDefault(),removeSelected(b),a.currentTarget.classList.add("selected"),getSelectedOptions()},!0)})}),getSelectedOptions();const handleSubmit=()=>{const a="".concat(apiUrlBase,"/cart/add"),b=new FormData(productForm),c=b.get("cardId"),d={productVariant:b.get("productVariant"),productVariantSku:b.get("productVariantSku"),cardId:c,cardMessage:b.get("cardMessage"),blankCard:b.get("blankCard"),checkoutId:getCookie("checkoutId")},e=new XMLHttpRequest;e.open("POST",a),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(JSON.stringify(d)),submitButton.disabled=!0,submitButton.innerText="Loading...",e.addEventListener("loadend",()=>{if(200===e.status){const a=JSON.parse(e.responseText);if(a.cart){const b=a.cart.data.theCart.checkout.lineItems.edges,c=sumQuantity(b,"quantity");if(setCookie("checkoutId",a.cart.data.theCart.checkout.id,1),setCookie("checkoutUrl",a.cart.data.theCart.checkout.webUrl,1),"function"==typeof updateCartBadge&&(updateCartBadge(c),setCookie("cartCount",c,1)),submitButton.disabled=!1,submitButton.innerText="Added to Cart",!0===checkCartValid(b)){const d=countDigitalGiftCards(b);if(0<d)window.location=c===d?a.cart.data.theCart.checkout.webUrl:"/cart/";else{const a=submitButton.getAttribute("data-crosssell");if("true"===a){const a=submitButton.getAttribute("data-crosssell-tier");window.location="null"===a?"/delivery-details/":"/extras/".concat(a)}else window.location="/delivery-details/"}}else window.location="/cart/"}else if(a.error){submitButton.disabled=!0,submitButton.innerText="Send Now";const b={};switch(a.error.code){case"NOT_ALLOWED_INCLUDE_NOUPSELL_WITH_OTHERS":b.text="Unfortunately, you cannot add <b>".concat(a.error.productToAddTitle||"it","</b> to your basket as it can only be sent on its own.\n            <br />Should you need further assistance please contact customer service on 0800 0350 581.");break;case"NOT_ALLOWED_INCLUDE_LETTERBOX_WITH_OTHERS":b.text="Unfortunately, you cannot add <b>".concat(a.error.productToAddTitle||"it","</b> to your basket as it can only be sent on its own.\n            <br />Should you need further assistance please contact customer service on 0800 0350 581.");break;case"NOT_ALLOWED_INCLUDE_WHEN_NOUPSELL_IN_CART":b.text="Unfortunately, you cannot add more items to this basket, <b>".concat(a.error.productInConflict||"it"," </b>\n            can only be shipped on it's own <br />Should you need further assistance please contact customer service on 0800 0350 581.");break;case"NOT_ALLOWED_INCLUDE_WHEN_LETTERBOX_IN_CART":b.text="Unfortunately, you cannot add more items to this basket, <b>".concat(a.error.productInConflict||"it"," </b>\n            can only be shipped on it's own <br />Should you need further assistance please contact customer service on 0800 0350 581.");break;default:b.text="Unfortunately, you cannot add more items to this basket, it can only be shipped on it's own.\n            <br />Should you need further assistance please contact customer service on 0800 0350 581.";}showToast({title:"PROBLEM WITH BASKET!",message:b.text,time:30})}else window.location="/cart/"}else submitButton.innerText="Error"})};window.addEventListener("DOMContentLoaded",()=>{const a=document.querySelector(".carousel");if(a&&"undefined"!=typeof Carousel){const b=new Carousel(a);b.setPlayOnce(!0)}if(showCardEditor&&"undefined"!=typeof CardEditor){const a=document.getElementById("cardId"),b=document.getElementById("blankCard"),c=document.getElementById("cardMessage");(()=>new CardEditor({title:"Add a free <b>gift card</b>",saveBtnLabel:"Checkout",onSelect:d=>{a.value=d.cardId,b.value=d.leaveBlank,c.value=d.cardMessage,handleSubmit()},readyCallback:a=>{submitButton.addEventListener("click",b=>{b.preventDefault(),a.openSelector()})}}))()}else// add event to submit form without card selector
submitButton.addEventListener("click",a=>{a.preventDefault(),handleSubmit()});"function"==typeof mouseScrollX&&mouseScrollX(".product-grid")});